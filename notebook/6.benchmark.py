# -*- coding: utf-8 -*-
"""Benchmark

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/185JU89eWqp6oapGUBQvO92FvAOUCeRWQ

#Benchmark

##Demographic Dataset
"""

# =========================================================
# Benchmark model klasifikasi klasik
# Tujuan:
# - Mengukur performa BoW/TFIDF/Bigram dengan model dasar.
# =========================================================

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report, accuracy_score, f1_score
from sklearn.linear_model import LogisticRegression
from sklearn.naive_bayes import MultinomialNB

df = pd.read_csv("/content/demographics_with_qi_labels.csv")
y = df["label"]

# Dataset fitur hasil Feature Selection
datasets = {
    "BoW": "/content/FS_BOW_demographics.csv",
    "TFIDF": "/content/FS_TFIDF_demographics.csv",
    "BIGRAM": "/content/FS_BIGRAM_demographics.csv"
}

# === NEW: Tempat menyimpan semua hasil ===
results = []

for name, path in datasets.items():
    print(f"\n=== Benchmark: {name} ===")
    X = pd.read_csv(path)

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, random_state=42
    )

    # ---------------------------------------------------------
    # 1. Logistic Regression
    # ---------------------------------------------------------
    model_lr = LogisticRegression(max_iter=200)
    model_lr.fit(X_train, y_train)
    pred_lr = model_lr.predict(X_test)

    print("\nLogistic Regression:")
    print(classification_report(y_test, pred_lr))

    acc_lr = accuracy_score(y_test, pred_lr)
    f1_lr = f1_score(y_test, pred_lr, average="weighted")

    results.append({
        "Fitur": name,
        "Model": "LogisticRegression",
        "Accuracy": acc_lr,
        "F1-score": f1_lr
    })

    # ---------------------------------------------------------
    # 2. Multinomial Naive Bayes
    # ---------------------------------------------------------
    model_nb = MultinomialNB()
    model_nb.fit(X_train, y_train)
    pred_nb = model_nb.predict(X_test)

    print("\nMultinomialNB:")
    print(classification_report(y_test, pred_nb))

    acc_nb = accuracy_score(y_test, pred_nb)
    f1_nb = f1_score(y_test, pred_nb, average="weighted")

    results.append({
        "Fitur": name,
        "Model": "MultinomialNB",
        "Accuracy": acc_nb,
        "F1-score": f1_nb
    })

# =========================================================
# SIMPAN & TAMPILKAN TABEL
# =========================================================
benchmark_df = pd.DataFrame(results).sort_values(
    by="Accuracy", ascending=False
).reset_index(drop=True)

out_path = "/content/Benchmark_LR_NB_CR.csv"
benchmark_df.to_csv(out_path, index=False, encoding="utf-8-sig")

styled_table = (
    benchmark_df.style
    .background_gradient(subset=["Accuracy"], cmap="YlGn")
    .highlight_max(subset=["Accuracy"], color="#b6e4b1")
    .set_properties(**{
        "text-align": "center",
        "border": "1px solid #ccc"
    })
    .set_table_styles([
        {
            "selector": "thead th",
            "props": [
                ("background-color", "#f0f0f0"),
                ("color", "#333"),
                ("font-weight", "bold")
            ]
        }
    ])
)

print("\nHASIL BENCHMARK (diurutkan dari akurasi tertinggi):")
display(styled_table)

best = benchmark_df.iloc[0]
print("\nMODEL TERBAIK:")
print(f"   ‚Ä¢ Fitur : {best['Fitur']}")
print(f"   ‚Ä¢ Model : {best['Model']}")
print(f"   ‚Ä¢ Accuracy : {best['Accuracy']}")
print(f"   ‚Ä¢ F1-score : {best['F1-score']}")

print(f"\nSemua hasil benchmark disimpan di: {out_path}")

"""#Benchmark

##Clinical Dataset
"""

# =========================================================
# üß† BENCHMARK LENGKAP ‚Äî CLINICAL DATA (SAMA SEPERTI DEMOGRAPHIC)
# =========================================================
# Evaluasi semua kombinasi fitur (BoW, TF-IDF, Bigram)
# dengan model klasik (Logistic Regression & Naive Bayes)
# Menampilkan Classification Report + CV hasil tiap kombinasi
# =========================================================

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.linear_model import LogisticRegression
from sklearn.naive_bayes import MultinomialNB
from sklearn.metrics import classification_report

# === 1Ô∏è‚É£ Load dataset utama ===
df = pd.read_csv("/content/ClinicalData_with_qi_labels.csv")
assert "clean_text" in df.columns, "Kolom 'clean_text' tidak ditemukan!"
assert "label" in df.columns, "Kolom 'label' tidak ditemukan!"

X_text = df["clean_text"].astype(str)
y = df["label"].astype(str)

# === 2Ô∏è‚É£ Load hasil feature selection ===
SET_FEATURES = {
    "BoW_FS": "/content/FS_BoW_ClinicalData.csv",
    "TFIDF_FS": "/content/FS_TFIDF_ClinicalData.csv",
    "BIGRAM_FS": "/content/FS_BIGRAM_ClinicalData.csv",
}

# === 3Ô∏è‚É£ Model yang diuji ===
models = {
    "Logistic Regression": LogisticRegression(max_iter=2000, solver="liblinear"),
    "Naive Bayes": MultinomialNB(),
}

rows = []
print("üöÄ Memulai benchmark penuh untuk Clinical Dataset...\n")

for feat_name, feat_path in SET_FEATURES.items():
    X = pd.read_csv(feat_path).values
    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, random_state=42, stratify=y
    )

    print(f"\n{'='*80}")
    print(f"üîπ EKSTRAKSI FITUR: {feat_name} (jumlah fitur: {X.shape[1]})")
    print(f"{'='*80}")

    for model_name, model in models.items():
        print(f"\n‚öôÔ∏è  MODEL: {model_name}")
        model.fit(X_train, y_train)
        y_pred = model.predict(X_test)

        # Akurasi
        train_acc = model.score(X_train, y_train)
        test_acc = model.score(X_test, y_test)
        cv_scores = cross_val_score(model, X_train, y_train, cv=5)

        # === Classification Report ===
        print("\nüìã Classification Report:")
        print(classification_report(y_test, y_pred, digits=4))

        print(f"üìä Train Acc: {train_acc:.4f} | Test Acc: {test_acc:.4f} | "
              f"CV Mean: {cv_scores.mean():.4f} | CV Std: {cv_scores.std():.4f}\n")

        rows.append({
            "Fitur": feat_name,
            "Model": model_name,
            "Train Accuracy": round(train_acc, 4),
            "Test Accuracy": round(test_acc, 4),
            "CV Mean": round(cv_scores.mean(), 4),
            "CV Std": round(cv_scores.std(), 4),
            "Jumlah Fitur": X.shape[1]
        })

# === 4Ô∏è‚É£ Simpan hasil ke CSV ===
bench_df = pd.DataFrame(rows).sort_values(["Test Accuracy","CV Mean"], ascending=False)
OUT_PATH = "/content/Benchmark_ClinicalData.csv"
bench_df.to_csv(OUT_PATH, index=False, encoding="utf-8-sig")

print("\n‚úÖ Benchmark lengkap selesai! Hasil disimpan di:", OUT_PATH)
display(bench_df.style.background_gradient(
    subset=["Test Accuracy","CV Mean"], cmap="YlGn").format(precision=4))